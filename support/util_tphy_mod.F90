MODULE UTIL_TPHY_MOD

USE YOMPHY, ONLY : TPHY
USE UTIL_TDPRECIPS_MOD
USE UTIL_TDVISI_MOD

INTERFACE SAVE
MODULE PROCEDURE SAVE_TPHY
END INTERFACE

INTERFACE LOAD
MODULE PROCEDURE LOAD_TPHY
END INTERFACE

INTERFACE COPY
MODULE PROCEDURE COPY_TPHY
END INTERFACE

INTERFACE WIPE
MODULE PROCEDURE WIPE_TPHY
END INTERFACE



CONTAINS

SUBROUTINE SAVE_TPHY (KLUN, YD)
IMPLICIT NONE
INTEGER, INTENT (IN) :: KLUN
TYPE (TPHY), INTENT (IN), TARGET :: YD

WRITE (KLUN) YD%NBITER
WRITE (KLUN) YD%NITERFL
WRITE (KLUN) YD%NDPSFI
WRITE (KLUN) YD%LMPHYS
WRITE (KLUN) YD%LREASUR
WRITE (KLUN) YD%LCAPE
WRITE (KLUN) YD%LCVGQD
WRITE (KLUN) YD%LCVGQM
WRITE (KLUN) YD%LCVGQP
WRITE (KLUN) YD%LCONDWT
WRITE (KLUN) YD%LCVDD
WRITE (KLUN) YD%LCVPGY
WRITE (KLUN) YD%LCVPP
WRITE (KLUN) YD%LDIFCEXP
WRITE (KLUN) YD%LDIFCONS
WRITE (KLUN) YD%LDIFQL
WRITE (KLUN) YD%LDISTUR
WRITE (KLUN) YD%LNEIGE
WRITE (KLUN) YD%LRNUMX
WRITE (KLUN) YD%LRNUEXP
WRITE (KLUN) YD%LRTRUEBBC
WRITE (KLUN) YD%LRTRUEDIR
WRITE (KLUN) YD%LACPANMX
WRITE (KLUN) YD%LCLSATUR
WRITE (KLUN) YD%LVOIGT
WRITE (KLUN) YD%LGLACIERS
WRITE (KLUN) YD%LVFULL
WRITE (KLUN) YD%LSLC
WRITE (KLUN) YD%LRAYLU
WRITE (KLUN) YD%LREWS
WRITE (KLUN) YD%LRPROX
WRITE (KLUN) YD%LRMIX
WRITE (KLUN) YD%LRSTAB
WRITE (KLUN) YD%LRSTAER
WRITE (KLUN) YD%LRTPP
WRITE (KLUN) YD%LRTDL
WRITE (KLUN) YD%LRAYPL
WRITE (KLUN) YD%LRRGUST
WRITE (KLUN) YD%LO3ABC
WRITE (KLUN) YD%LO3FL
WRITE (KLUN) YD%LECSHAL
WRITE (KLUN) YD%LECDEEP
WRITE (KLUN) YD%LNEBNXR
WRITE (KLUN) YD%LNEB_FP
WRITE (KLUN) YD%LQXRTGH
WRITE (KLUN) YD%LHUCN
WRITE (KLUN) YD%LFPCOR
WRITE (KLUN) YD%LNOIAS
WRITE (KLUN) YD%LGLT
WRITE (KLUN) YD%LNEWD
WRITE (KLUN) YD%LPROCLD
WRITE (KLUN) YD%LEVAPP
WRITE (KLUN) YD%LCOLLEC
WRITE (KLUN) YD%LADJCLD
WRITE (KLUN) YD%LSEDSTA
WRITE (KLUN) YD%LSEDLAG
WRITE (KLUN) YD%LSEDCL
WRITE (KLUN) YD%LFSVAR
WRITE (KLUN) YD%LFSFIX
WRITE (KLUN) YD%LA0MPS
WRITE (KLUN) YD%LARPMPS
WRITE (KLUN) YD%L3MT
WRITE (KLUN) YD%LGPCMT
WRITE (KLUN) YD%LENTCH
WRITE (KLUN) YD%LCDDEVPRO
WRITE (KLUN) YD%LAEROSEA
WRITE (KLUN) YD%LAEROLAN
WRITE (KLUN) YD%LAEROSOO
WRITE (KLUN) YD%LAERODES
WRITE (KLUN) YD%LAEROVOL
WRITE (KLUN) YD%LAEROSUL
WRITE (KLUN) YD%LRELAXT
WRITE (KLUN) YD%LRELAXW
WRITE (KLUN) YD%LSSD
WRITE (KLUN) YD%LPBLE
WRITE (KLUN) YD%LBLVAR
WRITE (KLUN) YD%LZ0HSREL
WRITE (KLUN) YD%LMLH
WRITE (KLUN) YD%LNODIFQC
WRITE (KLUN) YD%LNCVPGY
WRITE (KLUN) YD%LSQRML
WRITE (KLUN) YD%LAB12
WRITE (KLUN) YD%LCVSHCU
WRITE (KLUN) YD%LCVGQ
WRITE (KLUN) YD%LPEC
WRITE (KLUN) YD%LUDEVOL
WRITE (KLUN) YD%LCDDCSD
WRITE (KLUN) YD%NCLOMIX
WRITE (KLUN) YD%NFSIG
WRITE (KLUN) YD%LHLRADUPD
WRITE (KLUN) YD%NDPRECPERIOD
WRITE (KLUN) YD%NDPRECPERIOD2
WRITE (KLUN) YD%LDPRECIPS
WRITE (KLUN) YD%LDPRECIPS2
CALL SAVE (KLUN, YD%YRDPRECIPS)
CALL SAVE (KLUN, YD%YRDVISI)
WRITE (KLUN) YD%CGMIXLEN
WRITE (KLUN) YD%CGTURS
WRITE (KLUN) YD%CGTRG
WRITE (KLUN) YD%LPRGML
WRITE (KLUN) YD%LCVRA
WRITE (KLUN) YD%LCVTDK
WRITE (KLUN) YD%LDAYD
WRITE (KLUN) YD%LCVPRO
WRITE (KLUN) YD%LGRAPRO
WRITE (KLUN) YD%LCDDPRO
WRITE (KLUN) YD%LCVCSD
WRITE (KLUN) YD%LUSL
WRITE (KLUN) YD%LNSDO
WRITE (KLUN) YD%LECT
WRITE (KLUN) YD%LEFB
WRITE (KLUN) YD%LFLUSO
WRITE (KLUN) YD%LECTQ1
WRITE (KLUN) YD%LECTREP
WRITE (KLUN) YD%LPTKE
WRITE (KLUN) YD%LCOEFKTKE
WRITE (KLUN) YD%LCOEFKSURF
WRITE (KLUN) YD%LCOEFK_MSC
WRITE (KLUN) YD%LCOEFK_F1
WRITE (KLUN) YD%LCOEFK_TOMS
WRITE (KLUN) YD%LCOEFK_THS1
WRITE (KLUN) YD%LCOEFK_RIS
WRITE (KLUN) YD%LCOEFK_PL
WRITE (KLUN) YD%LCOEFK_ML
WRITE (KLUN) YD%LCOEFK_PTTE
WRITE (KLUN) YD%LCOEFK_FLX
WRITE (KLUN) YD%LCOEFK_SCQ
WRITE (KLUN) YD%LAFGD_A
WRITE (KLUN) YD%LGWD
WRITE (KLUN) YD%LGWDC
WRITE (KLUN) YD%LNORGWD
WRITE (KLUN) YD%LHMTO
WRITE (KLUN) YD%LNEBCO
WRITE (KLUN) YD%LNEBN
WRITE (KLUN) YD%LNEBR
WRITE (KLUN) YD%LPTOPC
WRITE (KLUN) YD%LOZONE
WRITE (KLUN) YD%LRAY
WRITE (KLUN) YD%LRAYFM
WRITE (KLUN) YD%LRMU0M
WRITE (KLUN) YD%LRAYFM15
WRITE (KLUN) YD%LRRMES
WRITE (KLUN) YD%LSFHYD
WRITE (KLUN) YD%LSNV
WRITE (KLUN) YD%LSOLV
WRITE (KLUN) YD%LFGEL
WRITE (KLUN) YD%LSTRA
WRITE (KLUN) YD%LSTRAS
WRITE (KLUN) YD%LSTRAPRO
WRITE (KLUN) YD%LNEWSTAT
WRITE (KLUN) YD%LTHERMO
WRITE (KLUN) YD%LVDIF
WRITE (KLUN) YD%LCVLIS
WRITE (KLUN) YD%LCVCAS
WRITE (KLUN) YD%LSCMF
WRITE (KLUN) YD%LVGSN
WRITE (KLUN) YD%LPHCDPI
WRITE (KLUN) YD%LNEBGR
WRITE (KLUN) YD%LNEBGY
WRITE (KLUN) YD%LCVRAV3
WRITE (KLUN) YD%LCVPPKF
WRITE (KLUN) YD%LCVTURB
WRITE (KLUN) YD%LNEBRIC
WRITE (KLUN) YD%LEDKF
WRITE (KLUN) YD%LEDMFI
WRITE (KLUN) YD%LEDMFS
WRITE (KLUN) YD%LECTFL
WRITE (KLUN) YD%LECTFL0
WRITE (KLUN) YD%NPHYREP
WRITE (KLUN) YD%NOIR
WRITE (KLUN) YD%LCAMOD
WRITE (KLUN) YD%LCOMOD
WRITE (KLUN) YD%LPHSPSH
WRITE (KLUN) YD%LSMNIMBT
WRITE (KLUN) YD%LSMTPS
WRITE (KLUN) YD%LSMGCDEV
WRITE (KLUN) YD%LXRCDEV
WRITE (KLUN) YD%LRKCDEV
WRITE (KLUN) YD%LSMITH_CDEV
WRITE (KLUN) YD%LRCVOTT
WRITE (KLUN) YD%LNEBCV
WRITE (KLUN) YD%LNEBINS
WRITE (KLUN) YD%NDIFFNEB
WRITE (KLUN) YD%NIMELIT
WRITE (KLUN) YD%NRAY
WRITE (KLUN) YD%NSORAYFR
WRITE (KLUN) YD%NTHRAYFR
WRITE (KLUN) YD%NRAUTOEV
WRITE (KLUN) YD%NSMTBOT
WRITE (KLUN) YD%NSMDNEB
WRITE (KLUN) YD%NPRAC
WRITE (KLUN) YD%NPRRI
WRITE (KLUN) YD%NPHY
WRITE (KLUN) YD%NCALLRAD
WRITE (KLUN) YD%NLEND
WRITE (KLUN) YD%NTEND_DIAG_POS
WRITE (KLUN) YD%NTEND_DIAG_FREQ_RESET
WRITE (KLUN) YD%LNEBECT
WRITE (KLUN) YD%LCVGQKF
WRITE (KLUN) YD%LACDIFUS
WRITE (KLUN) YD%L2MICRO
WRITE (KLUN) YD%LAJUCV
WRITE (KLUN) YD%LSMOOTHMELT
WRITE (KLUN) YD%LGCHECKMV
WRITE (KLUN) YD%LGCHECKNAN
WRITE (KLUN) YD%LEDR
WRITE (KLUN) YD%LWINDFARM
WRITE (KLUN) YD%LVOLKER
WRITE (KLUN) YD%NWINDFARMMODORO
WRITE (KLUN) YD%LAPL_ARPEGE
END SUBROUTINE

SUBROUTINE LOAD_TPHY (KLUN, YD)
IMPLICIT NONE
INTEGER, INTENT (IN) :: KLUN
TYPE (TPHY), INTENT (OUT), TARGET :: YD

READ (KLUN) YD%NBITER
READ (KLUN) YD%NITERFL
READ (KLUN) YD%NDPSFI
READ (KLUN) YD%LMPHYS
READ (KLUN) YD%LREASUR
READ (KLUN) YD%LCAPE
READ (KLUN) YD%LCVGQD
READ (KLUN) YD%LCVGQM
READ (KLUN) YD%LCVGQP
READ (KLUN) YD%LCONDWT
READ (KLUN) YD%LCVDD
READ (KLUN) YD%LCVPGY
READ (KLUN) YD%LCVPP
READ (KLUN) YD%LDIFCEXP
READ (KLUN) YD%LDIFCONS
READ (KLUN) YD%LDIFQL
READ (KLUN) YD%LDISTUR
READ (KLUN) YD%LNEIGE
READ (KLUN) YD%LRNUMX
READ (KLUN) YD%LRNUEXP
READ (KLUN) YD%LRTRUEBBC
READ (KLUN) YD%LRTRUEDIR
READ (KLUN) YD%LACPANMX
READ (KLUN) YD%LCLSATUR
READ (KLUN) YD%LVOIGT
READ (KLUN) YD%LGLACIERS
READ (KLUN) YD%LVFULL
READ (KLUN) YD%LSLC
READ (KLUN) YD%LRAYLU
READ (KLUN) YD%LREWS
READ (KLUN) YD%LRPROX
READ (KLUN) YD%LRMIX
READ (KLUN) YD%LRSTAB
READ (KLUN) YD%LRSTAER
READ (KLUN) YD%LRTPP
READ (KLUN) YD%LRTDL
READ (KLUN) YD%LRAYPL
READ (KLUN) YD%LRRGUST
READ (KLUN) YD%LO3ABC
READ (KLUN) YD%LO3FL
READ (KLUN) YD%LECSHAL
READ (KLUN) YD%LECDEEP
READ (KLUN) YD%LNEBNXR
READ (KLUN) YD%LNEB_FP
READ (KLUN) YD%LQXRTGH
READ (KLUN) YD%LHUCN
READ (KLUN) YD%LFPCOR
READ (KLUN) YD%LNOIAS
READ (KLUN) YD%LGLT
READ (KLUN) YD%LNEWD
READ (KLUN) YD%LPROCLD
READ (KLUN) YD%LEVAPP
READ (KLUN) YD%LCOLLEC
READ (KLUN) YD%LADJCLD
READ (KLUN) YD%LSEDSTA
READ (KLUN) YD%LSEDLAG
READ (KLUN) YD%LSEDCL
READ (KLUN) YD%LFSVAR
READ (KLUN) YD%LFSFIX
READ (KLUN) YD%LA0MPS
READ (KLUN) YD%LARPMPS
READ (KLUN) YD%L3MT
READ (KLUN) YD%LGPCMT
READ (KLUN) YD%LENTCH
READ (KLUN) YD%LCDDEVPRO
READ (KLUN) YD%LAEROSEA
READ (KLUN) YD%LAEROLAN
READ (KLUN) YD%LAEROSOO
READ (KLUN) YD%LAERODES
READ (KLUN) YD%LAEROVOL
READ (KLUN) YD%LAEROSUL
READ (KLUN) YD%LRELAXT
READ (KLUN) YD%LRELAXW
READ (KLUN) YD%LSSD
READ (KLUN) YD%LPBLE
READ (KLUN) YD%LBLVAR
READ (KLUN) YD%LZ0HSREL
READ (KLUN) YD%LMLH
READ (KLUN) YD%LNODIFQC
READ (KLUN) YD%LNCVPGY
READ (KLUN) YD%LSQRML
READ (KLUN) YD%LAB12
READ (KLUN) YD%LCVSHCU
READ (KLUN) YD%LCVGQ
READ (KLUN) YD%LPEC
READ (KLUN) YD%LUDEVOL
READ (KLUN) YD%LCDDCSD
READ (KLUN) YD%NCLOMIX
READ (KLUN) YD%NFSIG
READ (KLUN) YD%LHLRADUPD
READ (KLUN) YD%NDPRECPERIOD
READ (KLUN) YD%NDPRECPERIOD2
READ (KLUN) YD%LDPRECIPS
READ (KLUN) YD%LDPRECIPS2
CALL LOAD (KLUN, YD%YRDPRECIPS)
CALL LOAD (KLUN, YD%YRDVISI)
READ (KLUN) YD%CGMIXLEN
READ (KLUN) YD%CGTURS
READ (KLUN) YD%CGTRG
READ (KLUN) YD%LPRGML
READ (KLUN) YD%LCVRA
READ (KLUN) YD%LCVTDK
READ (KLUN) YD%LDAYD
READ (KLUN) YD%LCVPRO
READ (KLUN) YD%LGRAPRO
READ (KLUN) YD%LCDDPRO
READ (KLUN) YD%LCVCSD
READ (KLUN) YD%LUSL
READ (KLUN) YD%LNSDO
READ (KLUN) YD%LECT
READ (KLUN) YD%LEFB
READ (KLUN) YD%LFLUSO
READ (KLUN) YD%LECTQ1
READ (KLUN) YD%LECTREP
READ (KLUN) YD%LPTKE
READ (KLUN) YD%LCOEFKTKE
READ (KLUN) YD%LCOEFKSURF
READ (KLUN) YD%LCOEFK_MSC
READ (KLUN) YD%LCOEFK_F1
READ (KLUN) YD%LCOEFK_TOMS
READ (KLUN) YD%LCOEFK_THS1
READ (KLUN) YD%LCOEFK_RIS
READ (KLUN) YD%LCOEFK_PL
READ (KLUN) YD%LCOEFK_ML
READ (KLUN) YD%LCOEFK_PTTE
READ (KLUN) YD%LCOEFK_FLX
READ (KLUN) YD%LCOEFK_SCQ
READ (KLUN) YD%LAFGD_A
READ (KLUN) YD%LGWD
READ (KLUN) YD%LGWDC
READ (KLUN) YD%LNORGWD
READ (KLUN) YD%LHMTO
READ (KLUN) YD%LNEBCO
READ (KLUN) YD%LNEBN
READ (KLUN) YD%LNEBR
READ (KLUN) YD%LPTOPC
READ (KLUN) YD%LOZONE
READ (KLUN) YD%LRAY
READ (KLUN) YD%LRAYFM
READ (KLUN) YD%LRMU0M
READ (KLUN) YD%LRAYFM15
READ (KLUN) YD%LRRMES
READ (KLUN) YD%LSFHYD
READ (KLUN) YD%LSNV
READ (KLUN) YD%LSOLV
READ (KLUN) YD%LFGEL
READ (KLUN) YD%LSTRA
READ (KLUN) YD%LSTRAS
READ (KLUN) YD%LSTRAPRO
READ (KLUN) YD%LNEWSTAT
READ (KLUN) YD%LTHERMO
READ (KLUN) YD%LVDIF
READ (KLUN) YD%LCVLIS
READ (KLUN) YD%LCVCAS
READ (KLUN) YD%LSCMF
READ (KLUN) YD%LVGSN
READ (KLUN) YD%LPHCDPI
READ (KLUN) YD%LNEBGR
READ (KLUN) YD%LNEBGY
READ (KLUN) YD%LCVRAV3
READ (KLUN) YD%LCVPPKF
READ (KLUN) YD%LCVTURB
READ (KLUN) YD%LNEBRIC
READ (KLUN) YD%LEDKF
READ (KLUN) YD%LEDMFI
READ (KLUN) YD%LEDMFS
READ (KLUN) YD%LECTFL
READ (KLUN) YD%LECTFL0
READ (KLUN) YD%NPHYREP
READ (KLUN) YD%NOIR
READ (KLUN) YD%LCAMOD
READ (KLUN) YD%LCOMOD
READ (KLUN) YD%LPHSPSH
READ (KLUN) YD%LSMNIMBT
READ (KLUN) YD%LSMTPS
READ (KLUN) YD%LSMGCDEV
READ (KLUN) YD%LXRCDEV
READ (KLUN) YD%LRKCDEV
READ (KLUN) YD%LSMITH_CDEV
READ (KLUN) YD%LRCVOTT
READ (KLUN) YD%LNEBCV
READ (KLUN) YD%LNEBINS
READ (KLUN) YD%NDIFFNEB
READ (KLUN) YD%NIMELIT
READ (KLUN) YD%NRAY
READ (KLUN) YD%NSORAYFR
READ (KLUN) YD%NTHRAYFR
READ (KLUN) YD%NRAUTOEV
READ (KLUN) YD%NSMTBOT
READ (KLUN) YD%NSMDNEB
READ (KLUN) YD%NPRAC
READ (KLUN) YD%NPRRI
READ (KLUN) YD%NPHY
READ (KLUN) YD%NCALLRAD
READ (KLUN) YD%NLEND
READ (KLUN) YD%NTEND_DIAG_POS
READ (KLUN) YD%NTEND_DIAG_FREQ_RESET
READ (KLUN) YD%LNEBECT
READ (KLUN) YD%LCVGQKF
READ (KLUN) YD%LACDIFUS
READ (KLUN) YD%L2MICRO
READ (KLUN) YD%LAJUCV
READ (KLUN) YD%LSMOOTHMELT
READ (KLUN) YD%LGCHECKMV
READ (KLUN) YD%LGCHECKNAN
READ (KLUN) YD%LEDR
READ (KLUN) YD%LWINDFARM
READ (KLUN) YD%LVOLKER
READ (KLUN) YD%NWINDFARMMODORO
READ (KLUN) YD%LAPL_ARPEGE
END SUBROUTINE


SUBROUTINE COPY_TPHY (YD, LDCREATED)
IMPLICIT NONE
TYPE (TPHY), INTENT (IN), TARGET :: YD
LOGICAL, OPTIONAL, INTENT (IN) :: LDCREATED
LOGICAL :: LLCREATED

LLCREATED = .FALSE.
IF (PRESENT (LDCREATED)) THEN
  LLCREATED = LDCREATED
ENDIF
IF (.NOT. LLCREATED) THEN
  !$acc enter data create (YD)
  !$acc update device (YD)
ENDIF






























































































CALL COPY (YD%YRDPRECIPS, LDCREATED=.TRUE.)

CALL COPY (YD%YRDVISI, LDCREATED=.TRUE.)



















































































































END SUBROUTINE

SUBROUTINE WIPE_TPHY (YD, LDDELETED)
IMPLICIT NONE
TYPE (TPHY), INTENT (IN), TARGET :: YD
LOGICAL, OPTIONAL, INTENT (IN) :: LDDELETED
LOGICAL :: LLDELETED































































































CALL WIPE (YD%YRDPRECIPS, LDDELETED=.TRUE.)

CALL WIPE (YD%YRDVISI, LDDELETED=.TRUE.)



















































































































LLDELETED = .FALSE.
IF (PRESENT (LDDELETED)) THEN
  LLDELETED = LDDELETED
ENDIF
IF (.NOT. LLDELETED) THEN
  !$acc exit data delete (YD)
ENDIF
END SUBROUTINE



END MODULE
